
# Nevatrip(техническое задание)

## Оглавление

- [Задание](#задание)
- [О проекте](#о-проекте)
- [Используемые технологии](#используемые-технологии)
- [Установка](#установка)
- [Задание №2](#задание-2)
- [Контакты](#контакты)

## Задание

**Задание №1**
После успешной покупки билетов на событие, данные попадают в список заказов. Список заказов сохраняется в таблице MySql в виде:

id - int(10) - инкрементальный порядковый номер заказа

event_id - int(11) - уникальный ид события. У каждого события есть свое название, описание, расписание, цены и свой уникальный event_id соответственно

event_date - varchar(10) - дата и время на которое были куплены билеты

ticket_adult_price - int(11) - цена взрослого билета на момент покупки

ticket_adult_quantity - int(11) - количество купленных взрослых билетов в этом заказе

ticket_kid_price - int(11) - цена детского билета на момент покупки

ticket_kid_quantity - int(11) - количество купленных детских билетов в этом заказе

barcode - varchar(120) - уникальный штрих код заказа

equal_price - int(11) - общая сумма заказа

created - datetime - дата создания заказа

Задача: написать функцию, которая будет добавлять заказы в эту таблицу.

Аргументы которые функция получает на входе: event_id, event_date, ticket_adult_price, ticket_adult_quantity, ticket_kid_price, ticket_kid_quantity

Нужно сгенерировать barcode, который будет уникальным со случайным набором цифр, он не должен быть порядковым.

Так же, существует некая сторонняя api.site.com. API писать не нужно, возвращаемые данные можно замокать и возвращать в случайном порядке. в которой нужно сделать бронь заказа отправив ей (https://api.site.com/book) event_id, event_date, ticket_adult_price, ticket_adult_quantity, ticket_kid_price, ticket_kid_quantity, barcode. На что она может вернуть либо {message: 'order successfully booked'}, либо {error: 'barcode already exists'}. В случае если получаем ошибку, нужно сгенерировать новый barcode и повторить попытку. Важно учесть, если запрос будет происходить одновременно, не должно возникнуть такой ситуации, что двум разным заказам присвоился один номер.

После успешной брони, нужно отправить на стороннюю апи запрос с подтверждением (https://api.site.com/approve), который принимает только barcode. Ответов может быть 2 варианта - успешный: {message: 'order successfully aproved'} и различные варианты ошибок {error: 'event cancelled'}, {error: 'no tickets'}, {error: 'no seats'}, {error: 'fan removed'}. В случае успеха, сохраняем заказ в БД

**Задание №2**
Некоторые события нужно продавать с дополнительными типами билетов - льготный и групповой, у которых будут свои цены и название. Имеется информация, что вероятно, будут другие типы билетов, которые нужно будет добавить. Нужно уметь сохранять при заказе 2 дополнительных типа билета, льготный и групповой в бд. Задача - Нормализовать таблицу учитывая добавленные типы билетов, показать конечный вид таблицы. Объяснить свое решение.
Часто посетители из одного заказа приходят не одновременно на события. Возникает необходимость проверять их билеты по отдельности. Для этого у каждого билета должен быть свой баркод. Если в одном заказе было куплено несколько билетов, 2 взрослых, 3 детских, 4 льготных - то должно быть 9 баркодов для каждого билета соответственно. Задача - Нормализовать таблицу, учитывая что у каждого билета свой баркод, показать конечный вид таблицы. Объяснить свое решение.
**Задание №3**
Сопроводить документацией своё решение.

## Используемые технологии

- **PHP:** Язык для реализации серверной логики.
- **MySQL:** Система управления базами данных для хранения информации.

## Установка

Пошаговые инструкции по установке и настройке моего проекта.

1. Клонируйте репозиторий:
   ```sh
   git clone https://github.com/MmGrand/BookingOrdersPHP.git
   ```
2. Перейдите в папку:
   ```sh
   cd BookingOrdersPHP
   ```
3. В файле db.php настройте доступы к базе данных под себя. Также создайте у себя базу данных и нужную таблицу.

4. Запустите сервер через docker, openserverpanel и т.д. и перейдите на главную страницу сайта.

5. При успешном результате, проверьте созданную запись в базе данных.

## Задание №2

1. Я создал ещё 2 таблицы: ticket_types и order_tickets. В одной я буду хранить типы билетов и их стоимость, а в другой id заказа, id типа билета. Суть в том, что теперь будет можно добавлять любые типы билетов и при этом не будут страдать другие таблицы, благодаря ticket_types. А таблицу order_tickets я создал, чтобы каждый билет можно привязать к конкретному заказу и не спутать итоговую сумму оплаты за заказ.

 Итоговая таблица orders:
  
  ![image](https://github.com/user-attachments/assets/13f7c9e1-2c4d-41d4-ac8d-f15ecdd75468)

2. Тут я просто перенес barcode в таблицу order_tickets и теперь получается у каждого билета будет свой уникальный barcode, что позволяет приходить посетителям не одновременно.

 Итоговая таблица orders:
 
  ![image](https://github.com/user-attachments/assets/258706c0-e1df-4372-99e9-03eb937a52bb)

3. Другие таблицы:

  ![image](https://github.com/user-attachments/assets/f836ddd7-c62c-42bd-b961-9651879882b4)

  ![image](https://github.com/user-attachments/assets/ecec44b2-aed4-4ba7-983b-53c343d31f89)


## Контакты

Если у вас есть вопросы или предложения, вы можете связаться со мной по ссылкам в профиле.
